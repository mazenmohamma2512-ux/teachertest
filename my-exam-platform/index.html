<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ù†Ù…Ø§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© - Ø§Ù„Ù…Ø¹Ù„Ù…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background: linear-gradient(145deg, #0a3144, #06212e);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #005a8c, #003153);
            padding: 40px;
            border-radius: 50px;
            margin-bottom: 30px;
            text-align: center;
            border: 4px solid #ffd966;
            box-shadow: 0 0 50px #ffd96680;
        }
        .header h1 {
            font-size: 5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #fff2b5, #ffd966, #ffe68f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px gold;
            margin-bottom: 10px;
        }
        .header h2 {
            font-size: 2.5rem;
            color: #f8f0d5;
            margin-bottom: 15px;
        }
        .header .teachers {
            font-size: 2rem;
            color: #ffdb8e;
            background: #00000060;
            display: inline-block;
            padding: 15px 50px;
            border-radius: 60px;
            border: 2px solid gold;
            line-height: 2;
        }
        .create-exam-btn {
            background: linear-gradient(145deg, #4CAF50, #2E7D32);
            border: none;
            padding: 20px 50px;
            border-radius: 60px;
            font-size: 2rem;
            font-weight: 800;
            color: white;
            box-shadow: 0 10px 0 #1B5E20;
            cursor: pointer;
            margin: 30px 0;
            border: 4px solid #a5d6a7;
        }
        .exams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .exam-card {
            background: #1a3340;
            border-radius: 40px;
            padding: 30px;
            border: 3px solid #b8860b;
        }
        .exam-card h3 {
            color: #ffd966;
            font-size: 2rem;
            margin-bottom: 15px;
        }
        .exam-card .info {
            color: #ffde94;
            font-size: 1.3rem;
            margin: 10px 0;
        }
        .exam-card .code {
            background: #0f2632;
            padding: 10px;
            border-radius: 30px;
            font-family: monospace;
            font-size: 1.8rem;
            color: #4CAF50;
            text-align: center;
            margin: 15px 0;
            border: 2px dashed gold;
        }
        .exam-card .link {
            background: #005a8c;
            color: white;
            padding: 10px;
            border-radius: 30px;
            font-size: 1.2rem;
            text-align: center;
            cursor: pointer;
            margin: 10px 0;
        }
        .exam-card .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .exam-card .stat-item {
            text-align: center;
        }
        .exam-card .stat-number {
            font-size: 2rem;
            color: #4CAF50;
            font-weight: 900;
        }
        .exam-card button {
            background: #005a8c;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 30px;
            width: 100%;
            margin-top: 10px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        .modal-content {
            background: #1a3340;
            max-width: 800px;
            margin: 30px auto;
            border-radius: 60px;
            padding: 40px;
            border: 5px solid gold;
        }
        .modal-content h2 {
            color: gold;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-group label {
            color: #ffd966;
            font-size: 1.5rem;
            display: block;
            margin-bottom: 10px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            background: #0f2632;
            border: 3px solid #b8860b;
            border-radius: 40px;
            color: #ffdf7e;
            font-size: 1.3rem;
        }
        .question-item {
            background: #0f2632;
            border-radius: 40px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #4CAF50;
        }
        .add-question-btn {
            background: #2c3e50;
            color: #ffd966;
            border: 2px solid #b8860b;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.3rem;
            cursor: pointer;
            margin: 10px 0;
        }
        .save-exam-btn {
            background: linear-gradient(145deg, #4CAF50, #2E7D32);
            border: none;
            padding: 20px 50px;
            border-radius: 60px;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            margin: 20px auto;
            display: block;
        }
        .close-btn {
            background: #ff6666;
            border: none;
            padding: 10px 30px;
            border-radius: 40px;
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            float: left;
        }
        .results-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            overflow-y: auto;
            padding: 30px;
        }
        .results-content {
            background: #1a3340;
            max-width: 1000px;
            margin: 30px auto;
            border-radius: 60px;
            padding: 40px;
            border: 5px solid gold;
        }
        .results-table {
            background: #0a1922;
            border-radius: 40px;
            padding: 20px;
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            color: #ffde94;
        }
        th {
            color: gold;
            font-size: 1.3rem;
            padding: 12px;
            border-bottom: 2px solid gold;
        }
        td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #5f6f7e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ« Ù…Ù†ØµØ© Ø§Ù„Ù†Ù…Ø§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
            <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¹Ù„Ù… - Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
            <div class="teachers">
                <i class="fas fa-chalkboard-teacher"></i> Ø¨Ø¥Ø´Ø±Ø§Ù Ù‚Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©<br>
                ÙˆÙ„Ø§Ø¡ Ø§Ù„Ø¨Ø¹ÙŠØ±Ø§Øª . ØºØ¯ÙŠØ± Ø§Ø¨Ùˆ Ø¹ØªÙŠÙ‚ . Ù…Ø§Ø²Ù† Ø§Ù„Ù„ÙˆØ¨Ø§Ù†ÙŠ
            </div>
        </div>

        <div style="text-align: center;">
            <button class="create-exam-btn" onclick="showCreateExamModal()">
                <i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯
            </button>
        </div>

        <div id="examsList" class="exams-grid">
            <!-- Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯ -->
    <div id="createExamModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="hideCreateExamModal()">âœ– Ø¥Ù„ØºØ§Ø¡</button>
            <h2><i class="fas fa-pen"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
            
            <div class="form-group">
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</label>
                <input type="text" id="examTitle" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø£ÙˆÙ„">
            </div>

            <div class="form-group">
                <label>Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                <select id="examSubject">
                    <option value="Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©">Ù…Ù‡Ø§Ø±Ø§Øª Ø±Ù‚Ù…ÙŠØ©</option>
                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                    <option value="ØªØ§Ø±ÙŠØ®">ØªØ§Ø±ÙŠØ®</option>
                    <option value="Ø¹Ù„ÙˆÙ… Ø£Ø±Ø¶">Ø¹Ù„ÙˆÙ… Ø£Ø±Ø¶</option>
                    <option value="Ø¬ØºØ±Ø§ÙÙŠØ§">Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                    <option value="ØªØ±Ø¨ÙŠØ© ÙˆØ·Ù†ÙŠØ©">ØªØ±Ø¨ÙŠØ© ÙˆØ·Ù†ÙŠØ©</option>
                    <option value="Ø«Ù‚Ø§ÙØ© Ù…Ø§Ù„ÙŠØ©">Ø«Ù‚Ø§ÙØ© Ù…Ø§Ù„ÙŠØ©</option>
                    <option value="Ø£Ø­ÙŠØ§Ø¡">Ø£Ø­ÙŠØ§Ø¡</option>
                    <option value="ÙƒÙŠÙ…ÙŠØ§Ø¡">ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                    <option value="ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
                </select>
            </div>

            <div class="form-group">
                <label>ÙƒÙˆØ¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡)</label>
                <input type="text" id="examCode" placeholder="Ù…Ø«Ø§Ù„: EXAM2024" maxlength="10">
                <small style="color:#ffaa33;">Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ØªØ¹Ø·ÙŠÙ‡ Ù„Ù„Ø·Ù„Ø§Ø¨</small>
            </div>

            <div class="form-group">
                <label>Ù…Ø¯Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ - Ø­Ø¯ Ø£Ù‚ØµÙ‰ 120 Ø¯Ù‚ÙŠÙ‚Ø©)</label>
                <input type="number" id="examDuration" value="30" min="1" max="120">
            </div>

            <div id="questionsContainer">
                <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
            </div>

            <button class="add-question-btn" onclick="addQuestion()">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
            </button>

            <button class="save-exam-btn" onclick="saveExam()">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div id="resultsModal" class="results-modal">
        <div class="results-content">
            <button class="close-btn" onclick="hideResultsModal()">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
            <h2 style="color:gold; text-align:center; font-size:2.5rem; margin-bottom:20px;" id="resultsTitle"></h2>
            
            <div style="text-align:left; margin-bottom:20px;">
                <button class="add-question-btn" onclick="exportExamResults()">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                </button>
            </div>

            <div class="results-table" id="resultsTable">
                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        let exams = JSON.parse(localStorage.getItem('exams')) || [];
        let questionCount = 0;
        let currentExamId = null;

        function showCreateExamModal() {
            document.getElementById('createExamModal').style.display = 'block';
            addQuestion();
        }

        function hideCreateExamModal() {
            document.getElementById('createExamModal').style.display = 'none';
            document.getElementById('questionsContainer').innerHTML = '';
            questionCount = 0;
        }

        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questionsContainer');
            const questionHtml = `
                <div class="question-item" id="question-${questionCount}">
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                        <select onchange="toggleQuestionType(${questionCount}, this.value)">
                            <option value="quiz">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                            <option value="truefalse">ØµØ­/Ø®Ø·Ø£</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                        <textarea id="q-text-${questionCount}" rows="2"></textarea>
                    </div>
                    <div id="q-options-${questionCount}">
                        <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
                    </div>
                    <button class="add-question-btn" onclick="removeQuestion(${questionCount})" style="background:#ff6666; color:white;">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', questionHtml);
            toggleQuestionType(questionCount, 'quiz');
        }

        function toggleQuestionType(qId, type) {
            const optionsDiv = document.getElementById(`q-options-${qId}`);
            if (type === 'quiz') {
                optionsDiv.innerHTML = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</label>
                        <input type="text" id="q-opt1-${qId}" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                        <input type="text" id="q-opt2-${qId}" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</label>
                        <input type="text" id="q-opt3-${qId}" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹</label>
                        <input type="text" id="q-opt4-${qId}" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                        <select id="q-correct-${qId}">
                            <option value="1">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„</option>
                            <option value="2">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                            <option value="3">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«</option>
                            <option value="4">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                        </select>
                    </div>
                `;
            } else {
                optionsDiv.innerHTML = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                        <select id="q-correct-${qId}">
                            <option value="true">ØµØ­</option>
                            <option value="false">Ø®Ø·Ø£</option>
                        </select>
                    </div>
                `;
            }
        }

        function removeQuestion(qId) {
            document.getElementById(`question-${qId}`).remove();
        }

        function saveExam() {
            const title = document.getElementById('examTitle').value;
            const subject = document.getElementById('examSubject').value;
            const examCode = document.getElementById('examCode').value.trim();
            const duration = document.getElementById('examDuration').value;

            if (!title) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†');
                return;
            }

            if (!examCode) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†');
                return;
            }

            if (exams.some(e => e.code === examCode)) {
                alert('âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ¯ Ø¢Ø®Ø±');
                return;
            }

            const questions = [];
            for (let i = 1; i <= questionCount; i++) {
                const questionDiv = document.getElementById(`question-${i}`);
                if (questionDiv) {
                    const text = document.getElementById(`q-text-${i}`)?.value;
                    if (!text) continue;

                    const typeSelect = questionDiv.querySelector('select');
                    const type = typeSelect ? typeSelect.value : 'quiz';

                    let question = {
                        id: i,
                        type: type,
                        text: text
                    };

                    if (type === 'quiz') {
                        question.options = [
                            document.getElementById(`q-opt1-${i}`)?.value || '',
                            document.getElementById(`q-opt2-${i}`)?.value || '',
                            document.getElementById(`q-opt3-${i}`)?.value || '',
                            document.getElementById(`q-opt4-${i}`)?.value || ''
                        ];
                        const correctOpt = document.getElementById(`q-correct-${i}`)?.value;
                        question.correct = question.options[parseInt(correctOpt) - 1];
                    } else {
                        question.correct = document.getElementById(`q-correct-${i}`)?.value || 'true';
                    }

                    questions.push(question);
                }
            }

            if (questions.length === 0) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            const exam = {
                id: Date.now(),
                title: title,
                subject: subject,
                duration: parseInt(duration),
                code: examCode,
                questions: questions,
                date: new Date().toLocaleString('ar-EG'),
                results: []
            };

            exams.push(exam);
            localStorage.setItem('exams', JSON.stringify(exams));

            alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!\nÙƒÙˆØ¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ${examCode}`);
            hideCreateExamModal();
            renderExams();
        }

        function renderExams() {
            const container = document.getElementById('examsList');
            let html = '';

            exams.forEach(exam => {
                const studentCount = exam.results ? exam.results.length : 0;
                const avgScore = exam.results && exam.results.length > 0 
                    ? Math.round(exam.results.reduce((sum, r) => sum + (r.score/r.total*100), 0) / exam.results.length) 
                    : 0;

                html += `
                    <div class="exam-card">
                        <h3>${exam.title}</h3>
                        <div class="info"><i class="fas fa-book"></i> ${exam.subject}</div>
                        <div class="info"><i class="fas fa-clock"></i> ${exam.duration} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        <div class="code">${exam.code}</div>
                        <div class="link" onclick="copyExamLink('${exam.code}')">
                            <i class="fas fa-link"></i> Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                        </div>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number">${studentCount}</div>
                                <div>Ø·Ù„Ø§Ø¨</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">${avgScore}%</div>
                                <div>Ù…ØªÙˆØ³Ø·</div>
                            </div>
                        </div>
                        <button onclick="viewExamResults(${exam.id})">
                            <i class="fas fa-chart-bar"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </button>
                    </div>
                `;
            });

            container.innerHTML = html || '<p style="color:#ffaa33; text-align:center; font-size:2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø¨Ø¹Ø¯</p>';
        }

        window.copyExamLink = function(code) {
            const link = `${window.location.origin}/exam.html?code=${code}`;
            navigator.clipboard.writeText(link);
            alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!');
        };

        window.viewExamResults = function(examId) {
            const exam = exams.find(e => e.id === examId);
            if (!exam) return;

            currentExamId = examId;
            document.getElementById('resultsTitle').innerHTML = `<i class="fas fa-chart-bar"></i> Ù†ØªØ§Ø¦Ø¬: ${exam.title}`;

            let tableHtml = '<table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>';
            
            if (exam.results && exam.results.length > 0) {
                exam.results.forEach(r => {
                    tableHtml += `<tr><td>${r.name}</td><td>${r.grade}</td><td>${r.class}</td><td>${r.score}/${r.total}</td><td>${r.date}</td></tr>`;
                });
            } else {
                tableHtml += '<tr><td colspan="5" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯</td></tr>';
            }
            
            tableHtml += '</table>';
            document.getElementById('resultsTable').innerHTML = tableHtml;
            document.getElementById('resultsModal').style.display = 'block';
        };

        window.hideResultsModal = function() {
            document.getElementById('resultsModal').style.display = 'none';
        };

        window.exportExamResults = function() {
            const exam = exams.find(e => e.id === currentExamId);
            if (!exam || !exam.results || exam.results.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }

            const data = [['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø´Ø¹Ø¨Ø©', 'Ø§Ù„Ù†ØªÙŠØ¬Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®']];
            exam.results.forEach(r => {
                data.push([r.name, r.grade, r.class, `${r.score}/${r.total}`, r.date]);
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
            XLSX.writeFile(wb, `${exam.title}.xlsx`);
        };

        renderExams();
    </script>
</body>
</html>
